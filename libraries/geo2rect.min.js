!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.geo2rect=t.geo2rect||{})}(this,function(t){"use strict";function e(t){function e(t){for(var e=-Number.MAX_VALUE,o=null,n=0;n<t.coordinates.length;n++){var i=turf.area({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:"MultiPolygon"===t.type?[t.coordinates[n][0]]:[t.coordinates[n]]}});i>e&&(e=i,o=n)}return["MultiPolygon"===t.type?t.coordinates[o][0]:t.coordinates[o]]}return t.features.forEach(function(t,o){t.geometry.ocoordinates=t.geometry.coordinates,"MultiPolygon"===t.geometry.type&&(t.geometry.coordinates=e(t.geometry),t.geometry.type="Polygon"),t.geometry.coordinates.length>1&&(t.geometry.coordinates=e(t.geometry));var n=turf.bbox(t);if(t.geometry.centroid=[(n[2]-n[0])/2+n[0],(n[1]-n[3])/2+n[3]],t.geometry.coordinates[0].length<4)for(;t.geometry.coordinates[0].length<4;)t.geometry.coordinates[0].push(t.geometry.coordinates[0][0]);for(var i=t.geometry.coordinates[0],r=[],s=function(t){var e=void 0,o=Number.MAX_VALUE,s=void 0;switch(t){case 0:s=[n[0],n[3]];break;case 1:s=[n[2],n[3]];break;case 2:s=[n[2],n[1]];break;case 3:s=[n[0],n[1]]}if(i.forEach(function(t,n){var i=Math.abs(Math.sqrt(Math.pow(s[0]-t[0],2)+Math.pow(s[1]-t[1],2)));i<o&&(n<r[0]||n>r[r.length-1]||0===r.length)&&(o=i,e=n)}),r.length>=1){var a=0;if(r.length>=2)for(var c=1;c<r.length;c++){var h=r[c],u=r[c-1],f=void 0;f=u<h?h-u:h+(i.length-u),a+=f}var g=r[r.length-1],l=e,_=void 0;_=g<l?l-g:l+(i.length-g),i.length-_-a<4-t&&(e-=4-t,e<0&&(e+=i.length))}r.push(e)},a=0;a<4;a++)s(a);for(var c={},a=0;a<4;a++){var h=void 0,u=void 0,f=void 0,g=void 0;switch(a){case 0:f=0,g=0,h=[n[0],n[3]],u=[n[2],n[3]];break;case 1:f=1,g=0,h=[n[2],n[3]],u=[n[2],n[1]];break;case 2:f=1,g=1,h=[n[2],n[1]],u=[n[0],n[1]];break;case 3:f=0,g=1,h=[n[0],n[1]],u=[n[0],n[3]]}var l=u[0]-h[0],_=u[1]-h[1];0!=l&&(l/=Math.abs(l)),0!=_&&(_/=Math.abs(_)),_*=-1;var d=r[a],y=a===r.length-1?r[0]:r[a+1],v=void 0;v=d<y?y-d:y+(i.length-d);for(var p=0;p<v;p++){var m=d+p;m>i.length-1&&(m-=i.length),c[m]={c:t.geometry.centroid,x:f+l/v*p,y:g+_/v*p}}}t.geometry.qcoordinates=[];for(var w=1;w<i.length;w++)w===i.length-1?t.geometry.qcoordinates.push(c[0]):t.geometry.qcoordinates.push(c[w])}),t}var o=(function(){function t(t){this.value=t}function e(e){function o(t,e){return new Promise(function(o,i){var a={key:t,arg:e,resolve:o,reject:i,next:null};s?s=s.next=a:(r=s=a,n(t,e))})}function n(o,r){try{var s=e[o](r),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):i(s.done?"return":"normal",s.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}r=r.next,r?n(r.key,r.arg):s=null}var r,s;this._invoke=o,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),n=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),i=function(){function t(){o(this,t),this._data=null,this._svg=null,this._col_size=1,this._row_size=1,this._cols=1,this._rows=1,this._init=!1,this._mode="geo",this._rPath=d3.line(),this._path=d3.geoPath(),this._config={width:null,height:null,padding:20,key:null,projection:d3.geoMercator(),grid:null,duration:500}}return n(t,[{key:"update",value:function(){var t=this;null!==this._data&&null!==this._config.width&&null!==this._config.height&&!function(){var e=200;t._config.projection.center(d3.geoCentroid(t._data)).scale(e).translate([t._config.width/2,t._config.height/2]),t._path.projection(t._config.projection);var o=t._path.bounds(t._data),n=o[1][0]-o[0][0],i=o[1][1]-o[0][1],r=Math.max(1,.9/Math.max(n/(t._config.width-2*t._config.padding),i/(t._config.height-2*t._config.padding)));t._config.projection.scale(r*e),t._data.features.forEach(function(e){e.geometry.qcoordinates.forEach(function(e){var o=t._config.projection(e.c);e.pc=o})});var s=t;t._rPath.x(function(t){return(t.x-.5)*s._col_size+t.pc[0]}).y(function(t){return(t.y-.5)*s._row_size+t.pc[1]})}(),this._init=!0}},{key:"draw",value:function(){var t=this;this._init?!function(){var e=t,o=t._svg.selectAll("path").data(t._data.features);o.exit(),o.enter().append("path").attr("class",function(t){return"id-"+e.config.key(t)}),t._svg.selectAll("path").transition().duration(t._config.duration).attr("transform",function(t){var o=0,n=0;if("geo"!=e.mode){var i=e.config.grid[e.config.key(t)],r=e.config.projection(t.geometry.centroid);o=i.ox-r[0],n=i.oy-r[1]}return"translate("+o+","+n+")"}).attr("d",function(t,o){return"geo"===e._mode?e._path(t):e._rPath(t.geometry.qcoordinates)+"Z"})}():console.error("You must run update() first.")}},{key:"toggle",value:function(){"geo"==this._mode?this._mode="rect":this._mode="geo"}},{key:"data",get:function(){return this._data},set:function(t){t&&(this._data=t,this.update())}},{key:"mode",get:function(){return this._mode},set:function(t){t&&(this._mode=t)}},{key:"svg",get:function(){return this._svg},set:function(t){t&&(this._svg=t,this.update())}},{key:"config",get:function(){return this._config},set:function(t){if(t){for(var e in this._config)null!==this._config[e]||e in t?e in t&&(this._config[e]=t[e]):console.error("The config object must provide "+e);var o=this._config.grid;for(var n in o)o[n].x+1>this._cols&&(this._cols=o[n].x+1),o[n].y+1>this._rows&&(this._rows=o[n].y+1);this._col_size=(this._config.width-2*this._config.padding)/this._rows,this._row_size=(this._config.height-2*this._config.padding)/this._cols,this._col_size<this._row_size?this._row_size=this._col_size:this._col_size=this._row_size;for(var o in this._config.grid)this._config.grid[o].ox=this._config.width/2-this._cols/2*this._col_size+this._config.grid[o].x*this._col_size+this._col_size/2,this._config.grid[o].oy=this._config.height/2-this._rows/2*this._row_size+this._config.grid[o].y*this._row_size+this._row_size/2;this.update()}}}]),t}();t.compute=e,t.draw=i,Object.defineProperty(t,"__esModule",{value:!0})});